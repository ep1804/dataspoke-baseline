# DataHub Helm values — local dev sizing
# Chart: datahub/datahub version 0.8.3 (app version v1.4.0)
# Target cluster: 8 CPU / 14 GB RAM (minikube)
# Total memory limits (datahub services): ~3.6 GiB of ~7 GiB cluster-wide budget
#
# Service name overrides point to the datahub-prerequisites release.
# Because the prerequisites chart is installed as release name
# "datahub-prerequisites", all internal service names get the
# "datahub-prerequisites-" prefix.

global:
  sql:
    datasource:
      host: "datahub-prerequisites-mysql:3306"
      hostForMysqlClient: "datahub-prerequisites-mysql"
      port: "3306"
      url: "jdbc:mysql://datahub-prerequisites-mysql:3306/datahub?verifyServerCertificate=false&useSSL=true&useUnicode=yes&characterEncoding=UTF-8&enabledTLSProtocols=TLSv1.2"
      driver: "com.mysql.cj.jdbc.Driver"
      username: "root"
      password:
        secretRef: "mysql-secrets"
        secretKey: "mysql-root-password"
  elasticsearch:
    host: "elasticsearch-master"
    port: "9200"
  kafka:
    bootstrap:
      server: "datahub-prerequisites-kafka:9092"
    zookeeper:
      server: "datahub-prerequisites-zookeeper:2181"
    schemaregistry:
      type: INTERNAL
  graph_service_impl: elasticsearch

datahub-gms:
  resources:
    requests:
      cpu: "500m"
      memory: "768Mi"
    limits:
      cpu: "1500m"
      memory: "1536Mi"
  # Relaxed probes: GMS depends on ES, Kafka, and MySQL.  On a single-node
  # dev cluster a transient ES restart can make /health unreachable for
  # 30-60 s.  failureThreshold × periodSeconds ≈ 2 min tolerance prevents
  # unnecessary GMS restarts during infra recovery.
  livenessProbe:
    initialDelaySeconds: 60
    periodSeconds: 15
    timeoutSeconds: 10
    failureThreshold: 8
  readinessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 10
    failureThreshold: 4

datahub-frontend:
  resources:
    requests:
      cpu: "200m"
      memory: "384Mi"
    limits:
      cpu: "500m"
      memory: "768Mi"
  livenessProbe:
    initialDelaySeconds: 60
    periodSeconds: 15
    timeoutSeconds: 10
    failureThreshold: 6

datahub-mae-consumer:
  resources:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"

datahub-mce-consumer:
  resources:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"

datahub-actions:
  resources:
    requests:
      cpu: "50m"
      memory: "128Mi"
    limits:
      cpu: "200m"
      memory: "256Mi"
